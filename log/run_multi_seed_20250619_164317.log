2025-06-19 16:43:17,817 [INFO] Génération de l'exogenous dataset
2025-06-19 16:43:17,819 [INFO] Chargement des données...
2025-06-19 16:43:19,153 [INFO] Analyse de la stationnarité pour différents d...
2025-06-19 16:43:29,585 [DEBUG] d = 0.20 | p-value = 0.0156 => Stationnaire
2025-06-19 16:43:41,149 [DEBUG] d = 0.30 | p-value = 0.0000 => Stationnaire
2025-06-19 16:43:52,082 [DEBUG] d = 0.40 | p-value = 0.0000 => Stationnaire
2025-06-19 16:44:03,355 [DEBUG] d = 0.50 | p-value = 0.0000 => Stationnaire
2025-06-19 16:44:14,424 [DEBUG] d = 0.60 | p-value = 0.0000 => Stationnaire
2025-06-19 16:44:14,425 [INFO] d sélectionné pour la différentiation fractionnaire : 0.2
2025-06-19 16:44:22,213 [INFO] Calcul des indicateurs techniques...
2025-06-19 16:45:09,917 [INFO] Nettoyage des données...
2025-06-19 16:45:09,929 [INFO] Génération des labels triple barrière...
2025-06-19 16:45:10,605 [DEBUG] Window: 4h - Distribution des labels: {0: 0.7587039088463364, 2: 0.12577148282956163, 1: 0.11552460832410191}
2025-06-19 16:45:11,157 [DEBUG] Window: 8h - Distribution des labels: {0: 0.5913514796645039, 2: 0.2089729387561323, 1: 0.19967558157936383}
2025-06-19 16:45:11,707 [DEBUG] Window: 12h - Distribution des labels: {0: 0.4903070106029435, 2: 0.2576357018515588, 1: 0.2520572875454977}
2025-06-19 16:45:12,301 [DEBUG] Window: 24h - Distribution des labels: {0: 0.37648362082608006, 1: 0.31377591391042886, 2: 0.3097404652634911}
2025-06-19 16:45:13,105 [DEBUG] Window: 48h - Distribution des labels: {0: 0.35852191802500394, 1: 0.32311283430922616, 2: 0.3183652476657699}
2025-06-19 16:45:13,106 [INFO] PREDICTION_WINDOW sélectionnée : 24
2025-06-19 16:45:14,091 [INFO] Colonnes supprimées à cause d'une corrélation > 0.95 : ['high', 'low', 'close', 'sma_50', 'sma_200', 'ema_20', 'ema_100', 'rsi_dist_oversold', 'rsi_dist_overbought', 'bb_upper', 'bb_lower', 'price_diff_1', 'williams_r', 'kama', 'vwap']
2025-06-19 16:45:15,960 [INFO] Dataset sauvegardé sous C:\CWE_DA\Python\algo-trading-2\exogenous_model\dataset\features_and_target\features_and_target.csv
2025-06-19 16:45:15,960 [INFO] Construction des séquences...
2025-06-19 16:47:22,017 [INFO] Dataset séquentiel sauvegardé sous C:\CWE_DA\Python\algo-trading-2\exogenous_model\dataset\features_and_target\sequential_dataset.npz avec noms de colonnes
2025-06-19 16:47:23,239 [INFO] Démarrage de l'exécution multi-seeds : [42]

2025-06-19 16:47:23,240 [INFO] --- Début du run avec seed 42 ---
2025-06-19 16:47:23,388 [INFO] Entraînement du modèle principal
2025-06-19 16:48:20,100 [DEBUG] [Epoch 1/100] Train Loss: 0.4869 | Val Loss: 0.4820 | Best Val Loss: inf | 
2025-06-19 16:49:38,024 [DEBUG] [Epoch 6/100] Train Loss: 0.3672 | Val Loss: 0.3875 | Best Val Loss: 0.4058 | 
2025-06-19 16:50:45,198 [DEBUG] [Epoch 11/100] Train Loss: 0.2837 | Val Loss: 0.3339 | Best Val Loss: 0.3455 | 
2025-06-19 16:51:56,315 [DEBUG] [Epoch 16/100] Train Loss: 0.2489 | Val Loss: 0.3146 | Best Val Loss: 0.3194 | 
2025-06-19 16:53:10,404 [DEBUG] [Epoch 21/100] Train Loss: 0.2047 | Val Loss: 0.3107 | Best Val Loss: 0.3103 | 
2025-06-19 16:54:25,516 [DEBUG] [Epoch 26/100] Train Loss: 0.2016 | Val Loss: 0.3051 | Best Val Loss: 0.3103 | 
2025-06-19 16:55:49,085 [DEBUG] [Epoch 31/100] Train Loss: 0.1746 | Val Loss: 0.3128 | Best Val Loss: 0.3051 | 
2025-06-19 16:57:06,523 [DEBUG] [Epoch 36/100] Train Loss: 0.1589 | Val Loss: 0.3179 | Best Val Loss: 0.3051 | 
2025-06-19 16:57:06,523 [INFO] Early stopping at epoch 36
2025-06-19 16:57:06,920 [INFO] Évaluation du modèle principal
2025-06-19 16:57:07,990 [INFO] Accuracy: 0.6539, Precision: 0.6528, Recall: 0.6641, F1: 0.6540
2025-06-19 16:57:08,006 [INFO] Génération du dataset méta
2025-06-19 16:57:08,922 [INFO] Prédiction du modèle principal ...
2025-06-19 16:57:14,676 [INFO] Méta labels créés
2025-06-19 17:04:25,822 [INFO] Dataset sauvegardé sous C:\CWE_DA\Python\algo-trading-2\meta_model\dataset\features_and_target\meta_dataset_seed_42.csv
2025-06-19 17:04:26,045 [INFO] Entraînement et évaluation du modèle XGBoost méta
2025-06-19 17:05:44,764 [INFO] Distribution des classes méta: Classe 0 (erreur): 27.87%, Classe 1 (correct): 72.13%
2025-06-19 17:05:46,465 [INFO] Optimisation du seuil de décision par validation croisée...
2025-06-19 17:10:49,461 [INFO] Fold 1: seuil optimal = 0.6253
2025-06-19 17:13:32,734 [INFO] Fold 2: seuil optimal = 0.5600
2025-06-19 17:15:28,778 [INFO] Fold 3: seuil optimal = 0.5437
2025-06-19 17:15:28,780 [INFO] Seuil optimal médian: 0.5600
2025-06-19 17:15:28,781 [INFO] Entraînement final du méta-modèle...
2025-06-19 17:21:58,971 [INFO] Calibration du modèle...
2025-06-19 17:22:01,112 [INFO] Évaluation sur le set de test :
2025-06-19 17:22:01,134 [INFO]               precision    recall  f1-score   support

           0       0.40      0.22      0.28      1398
           1       0.74      0.87      0.80      3618

    accuracy                           0.69      5016
   macro avg       0.57      0.55      0.54      5016
weighted avg       0.65      0.69      0.66      5016

2025-06-19 17:22:01,165 [INFO] ROC AUC Score : 0.589286
2025-06-19 17:22:01,168 [INFO] Matrice de confusion :
[[ 307 1091]
 [ 458 3160]]
2025-06-19 17:22:01,169 [INFO] Classe 1 - Precision: 0.7434, Recall: 0.8734, F1: 0.8032
2025-06-19 17:22:01,196 [INFO] Top 10 des features importantes:
2025-06-19 17:22:01,196 [INFO]   4753: 0.0021
2025-06-19 17:22:01,196 [INFO]   3559: 0.0020
2025-06-19 17:22:01,197 [INFO]   4105: 0.0019
2025-06-19 17:22:01,197 [INFO]   5374: 0.0014
2025-06-19 17:22:01,197 [INFO]   4132: 0.0012
2025-06-19 17:22:01,197 [INFO]   4234: 0.0011
2025-06-19 17:22:01,198 [INFO]   4369: 0.0010
2025-06-19 17:22:01,198 [INFO]   3586: 0.0009
2025-06-19 17:22:01,198 [INFO]   5395: 0.0009
2025-06-19 17:22:01,198 [INFO]   4396: 0.0009
2025-06-19 17:22:01,235 [INFO] Modèle sauvegardé : C:\CWE_DA\Python\algo-trading-2\meta_model\results\seed_42\xgboost_meta_model_seed_42.joblib
2025-06-19 17:22:02,545 [ERROR] Erreur lors du traitement du seed 42: Object of type float32 is not JSON serializable
Traceback (most recent call last):
  File "C:\CWE_DA\Python\algo-trading-2\run_multi_seed.py", line 108, in run_multi_seed
    train_and_test_meta_xgboost(seed=seed, logger=logger)
  File "C:\CWE_DA\Python\algo-trading-2\meta_model\train_and_test\train_test_meta_xgboost.py", line 206, in train_and_test_meta_xgboost
    json.dump({
  File "C:\Program Files\Python310\lib\json\__init__.py", line 179, in dump
    for chunk in iterable:
  File "C:\Program Files\Python310\lib\json\encoder.py", line 431, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "C:\Program Files\Python310\lib\json\encoder.py", line 405, in _iterencode_dict
    yield from chunks
  File "C:\Program Files\Python310\lib\json\encoder.py", line 438, in _iterencode
    o = _default(o)
  File "C:\CWE_DA\Python\algo-trading-2\.venv\lib\site-packages\frozendict\__init__.py", line 32, in default
    return BaseJsonEncoder.default(
  File "C:\Program Files\Python310\lib\json\encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type float32 is not JSON serializable
2025-06-19 17:22:03,185 [INFO] Moyenne des scores sur tous les seeds :
2025-06-19 17:22:03,187 [INFO] accuracy            0.6539
precision_macro     0.6528
recall_macro        0.6641
f1_macro            0.6540
seed               42.0000
dtype: float64
2025-06-19 17:22:03,190 [INFO] Écart-type des scores :
2025-06-19 17:22:03,191 [INFO] accuracy          NaN
precision_macro   NaN
recall_macro      NaN
f1_macro          NaN
seed              NaN
dtype: float64
2025-06-19 17:22:03,196 [INFO] Résultats enregistrés dans meta_model/results/results_multi_seed.csv
